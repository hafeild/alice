<% provide(:title, @analysis.name) %>
<div class="container analysis-page" data-analysis-id="<%= @analysis.id %>">
  <h1><span class="name"><%= @analysis.name %></span>
  <% if can_edit? %>
    <button type="button" class="btn btn-primary btn-sm edit-toggle enable-editing">
      Enable editing
    </button>
    <button type="button" class="btn btn-primary btn-sm edit-toggle disable-editing">
      Disable editing
    </button>
    <span class="edit-toggle">
      <%= link_to edit_analysis_path(@analysis.id)  do 
        %><button type="button" class="btn btn-default btn-sm">
          <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit
        </button
      ><% end %>
      <%= link_to @analysis, method: :delete, data: {
          confirm: "Are you sure you want to delete this page?"} do 
        %><button type="button" class="btn btn-default btn-sm">
          <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> 
        Delete </button
      ><% end %>
    </span>
  <% end %>
  </h1>

  <div class="summary-wrapper">
    <h2>Summary</h2>
    <span class="summary"><%= @analysis.summary %></span>
  </div>

  <div class="description-wrapper">
    <h2>Description</h2>
    <div class="description">
          <%= sanitize_text(@analysis.description).html_safe %>
    </div>
  </div>
  
  <%= render(partial: "attachments/attachment_list",
      locals: { 
        vertical_from: @analysis, 
        data: @analysis.attachments,
        editable: true,
        title_tag: :h2 }) %>

  <div class="tags">
    <h2>Tags</h2>
    <% if can_edit? %>
      <span class="edit-toggle">
        <a href="<%= new_vertical_tag_path @analysis %>"
          ><button class="btn btn-sm btn-default">Add new</button
        ></a>
        <a href="<%= vertical_tag_index_path @analysis %>"
          ><button class="btn btn-sm btn-default">Add existing</button
        ></a>
      </span>
    <% end %>
    <ul>
      <%= render(partial: "tags/tag_badge", 
        collection: sort_by(@analysis.tags, :text), as: :tag,
        locals: {print_header: true, vertical: @analysis}) || 
        "There are currently no tags associated with this analysis." %>
    </ul>
  </div>

  <div class="web-resources">
    <h2>Web resources</h2>
    <% if can_edit? %>
      <span class="edit-toggle">
        <a href="<%= new_vertical_web_resource_path @analysis %>"
          ><button class="btn btn-sm btn-default">Add new</button
        ></a>
        <a href="<%= vertical_web_resource_index_path @analysis %>"
          ><button class="btn btn-sm btn-default">Add existing</button
        ></a>
      </span>
    <% end %>
    <ul>
      <%= render(partial: "web_resources/web_resource_list_item", 
        collection: sort_by(@analysis.web_resources, :description), as: :web_resource,
        locals: {print_header: true, vertical: @analysis}) || 
        "There are currently no web resources associated with this analysis." %>
    </ul>
  </div>

  <%= render(partial: "verticals_shared/related_vertical",
    locals: {title: "Implemented in the following software", vertical_from: @analysis, 
             vertical_to: Software.new, editable: true}) %>



  <%= render(partial: "verticals_shared/related_vertical",
    locals: {title: "Assignments used in", vertical_from: @analysis, 
             vertical_to: Assignment.new}) %>

    <%= render(partial: "examples/related_examples",
      locals: {title: "Examples used in", 
               vertical: @analysis, 
               editable: true,
               title_tag: :h2 }) %>

</div>
